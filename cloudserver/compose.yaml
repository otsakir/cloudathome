services:
  haproxy:
    build:
      context: .
      dockerfile: haproxy.dockerfile
    volumes:
      - ./docker/haproxy:/usr/local/etc/haproxy
    ports:
      - "443:443"
    user: haproxy

    extra_hosts:
      - "host.docker.internal:host-gateway"  # map host machine to this container to allow accessing http://localhost:8443 now under http://host.docker.internal:8443

  tunnelagent:
    build:
      context: .
      dockerfile: tunnelagent.dockerfile
    ports:
      - 8022:22
      - 8000:8000
    volumes:
      - ./tunnelagent/backend:/opt/app

#  proxyagent:
#    build:
#      context: .
#      dockerfile: proxyagent.dockerfile
#    ports:
#      - 8000:8000
#      - 1122:1122
#    volumes:
#      - ./proxyagent-app/backend:/app/backend  # disable this in production mode and COPY 'backend' in proxyagent.dockerfile
#      - ./docker/haproxy/haproxy.cfg:/etc/haproxy/haproxy.cfg
#      - haproxy-sockets:/var/lib/haproxy/sockets
